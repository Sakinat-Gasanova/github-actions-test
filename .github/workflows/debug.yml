name: Debug Workflow

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: self-hosted
    
    steps:
      # Шаг 0: Начало
      - name: Start
        run: echo "=== DEBUG WORKFLOW STARTED ==="
      
      # Шаг 1: Проверка базовых команд
      - name: Check basic commands
        run: |
          echo "1. Checking echo:"
          echo "Hello World"
          echo "Exit code: $?"
          
          echo "2. Checking pwd:"
          pwd
          echo "Exit code: $?"
          
          echo "3. Checking ls:"
          ls -la
          echo "Exit code: $?"
      
      # Шаг 2: Проверка Docker
      - name: Check Docker
        run: |
          echo "=== DOCKER CHECK ==="
          echo "4. Docker version:"
          docker --version
          DOCKER_EXIT=$?
          echo "Docker exit code: $DOCKER_EXIT"
          
          echo "5. Docker Compose version:"
          docker-compose --version
          COMPOSE_EXIT=$?
          echo "Docker Compose exit code: $COMPOSE_EXIT"
          
          if [ $DOCKER_EXIT -ne 0 ] || [ $COMPOSE_EXIT -ne 0 ]; then
            echo "WARNING: Docker may not be installed or running"
          fi
      
      # Шаг 3: Простая Docker команда
      - name: Simple Docker command
        run: |
          echo "=== SIMPLE DOCKER ==="
          echo "6. Running 'docker ps':"
          docker ps
          echo "Exit code: $?"
          
          echo "7. Running 'docker images':"
          docker images
          echo "Exit code: $?"
      
      # Шаг 4: Попытка Docker Compose
      - name: Try Docker Compose
        run: |
          echo "=== DOCKER COMPOSE ==="
          echo "8. Checking docker-compose.yml:"
          ls -la docker-compose.yml 2>/dev/null || echo "docker-compose.yml not found"
          
          echo "9. Trying docker-compose up:"
          docker-compose up -d 2>&1 | head -20
          echo "Exit code: ${PIPESTATUS[0]}"
      
      # Шаг 5: Финальный статус
      - name: Final status
        run: |
          echo "=== FINAL STATUS ==="
          echo "All debug steps completed"
          echo "Workflow should be marked as SUCCESS"
